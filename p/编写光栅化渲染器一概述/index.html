<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="光栅化 VS 光线追踪 图形学研究如何使用计算机模拟现实，当我们在谈渲染的时候，大致可以分为两个方向：\nRay Tracing，即光线追踪，一般用于离线渲染，效果好，但是计算量大，耗时长。 Rasterization，即光栅化，一般用于实时渲染，效果差，但是计算量小，耗时短。 实际上，在现代 GPU 和各种光栅化渲染算法的的加持下，光栅化的效果已经非常逼真了，光栅化的效果一点也不差。只是相比于光线追踪来说，效果还是差点。\n"><title>编写光栅化渲染器（一）概述</title>
<link rel=canonical href=https://nonlinearthink.github.io/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%80%E6%A6%82%E8%BF%B0/><link rel=stylesheet href=/scss/style.min.28d02563407050e3bdb7ae079a894dd5bde0477006465c9d6f6df82b9b36609d.css><meta property='og:title' content="编写光栅化渲染器（一）概述"><meta property='og:description' content="光栅化 VS 光线追踪 图形学研究如何使用计算机模拟现实，当我们在谈渲染的时候，大致可以分为两个方向：\nRay Tracing，即光线追踪，一般用于离线渲染，效果好，但是计算量大，耗时长。 Rasterization，即光栅化，一般用于实时渲染，效果差，但是计算量小，耗时短。 实际上，在现代 GPU 和各种光栅化渲染算法的的加持下，光栅化的效果已经非常逼真了，光栅化的效果一点也不差。只是相比于光线追踪来说，效果还是差点。\n"><meta property='og:url' content='https://nonlinearthink.github.io/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%80%E6%A6%82%E8%BF%B0/'><meta property='og:site_name' content='nonlinearthink'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Computer Graphics'><meta property='article:tag' content='Ray Tracing'><meta property='article:tag' content='Rasterization'><meta property='article:tag' content='SoftRenderer'><meta property='article:published_time' content='2023-12-02T14:15:23+08:00'><meta property='article:modified_time' content='2023-12-02T14:15:23+08:00'><meta name=twitter:title content="编写光栅化渲染器（一）概述"><meta name=twitter:description content="光栅化 VS 光线追踪 图形学研究如何使用计算机模拟现实，当我们在谈渲染的时候，大致可以分为两个方向：\nRay Tracing，即光线追踪，一般用于离线渲染，效果好，但是计算量大，耗时长。 Rasterization，即光栅化，一般用于实时渲染，效果差，但是计算量小，耗时短。 实际上，在现代 GPU 和各种光栅化渲染算法的的加持下，光栅化的效果已经非常逼真了，光栅化的效果一点也不差。只是相比于光线追踪来说，效果还是差点。\n"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu17793978945025570398.jpg width=300 height=301 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>☕</span></figure><div class=site-meta><h1 class=site-name><a href=/>nonlinearthink</a></h1><h2 class=site-description>Coding a fantasy world.</h2></div></header><ol class=menu-social><li><a href=https://github.com/nonlinearthink target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.zhihu.com/people/neweden-85 target=_blank title=知乎 rel=me><svg class="icon icon-tabler icon-tabler-brand-zhihu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6h6v12h-2l-2 2-1-2h-1z"/><path d="M4 12h6.5"/><path d="M10.5 6h-5"/><path d="M6 4c-.5 2.5-1.5 3.5-2.5 4.5"/><path d="M8 6v7c0 4.5-2 5.5-4 7"/><path d="M11 18l-3-5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>博客</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#光栅化-vs-光线追踪>光栅化 VS 光线追踪</a></li><li><a href=#像素>像素</a></li><li><a href=#光栅化程序开发流程>光栅化程序开发流程</a></li><li><a href=#reference>Reference</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8/>编写光栅化渲染器</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%80%E6%A6%82%E8%BF%B0/>编写光栅化渲染器（一）概述</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Dec 02, 2023</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 3 分钟</time></div></footer></div></header><section class=article-content><h2 id=光栅化-vs-光线追踪>光栅化 VS 光线追踪</h2><p>图形学研究如何使用计算机模拟现实，当我们在谈渲染的时候，大致可以分为两个方向：</p><ul><li><code>Ray Tracing</code>，即光线追踪，一般用于离线渲染，效果好，但是计算量大，耗时长。</li><li><code>Rasterization</code>，即光栅化，一般用于实时渲染，效果差，但是计算量小，耗时短。</li></ul><p>实际上，在现代 GPU 和各种光栅化渲染算法的的加持下，光栅化的效果已经非常逼真了，光栅化的效果一点也不差。只是相比于光线追踪来说，效果还是差点。</p><p>一个简单的光线追踪流程：发射一条光线，经过一系列地镜面反射、漫反射、折射等现象，最终打到一个物体上，得到一个颜色。几个原因导致了计算量的爆炸：</p><ol><li>像素数量多</li><li>因为反射和折射结果不稳定，一个像素需要几十甚至上百次采样平均才能获得一个稳定的结果</li><li>每一次采样都会反射或者折射很多次</li><li>每一次反射或者折射，都需要和场景中的每个物体相交判断，不过使用屏幕空间划分技术可以解决这个问题</li></ol><p>总结一下，光线追踪的时间复杂度：<code>Pixel * Sampling * (Reflection + Refraction) * (Object + Light)</code>，堪称炸裂。</p><p>如果你使用了屏幕空间划分技术（例如 BVH），会让结果好很多：<code>Pixel * Sampling * (Reflection + Refraction) * log(Object + Light)</code>。</p><p>还有一种优化思路，就是让采样结果更加稳定，一旦采样结果稳定了，就可以大幅减少采样数量，在传统的 <code>Whitted Style Ray Tracing</code> 中，具体的措施有比如通过蒙特卡洛方法求各种表面和光源的概率分布，比如对光源进行重要性采样。</p><p>一个简单的光栅化流程：把场景中所有物体的点经过矩阵计算映射到 2D 屏幕空间，三个顶点构成一个三角形，对每一个像素，取最近的三角形，计算三角形在这个像素的颜色（通过三个顶点颜色插值）。</p><h2 id=像素>像素</h2><p>无论是哪一种，都需要靠屏幕来展示它们，屏幕由一个一个像素构成，那么什么是像素呢？</p><p>通常来说，大部分普通人眼里的像素是这样的：</p><p><img src=/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%80%E6%A6%82%E8%BF%B0/rasterization.jpg width=462 height=354 srcset="/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%80%E6%A6%82%E8%BF%B0/rasterization_hu7254744277862116679.jpg 480w, /p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%80%E6%A6%82%E8%BF%B0/rasterization_hu4744009517828591404.jpg 1024w" loading=lazy alt=Rasterization class=gallery-image data-flex-grow=130 data-flex-basis=313px></p><p>这种网格模型深入人心，但是这种模型仅仅在光栅化的时候才是可接受的，对于光线追踪来说，可能完全不是这样。</p><p>像素并不是你想得那么简单，更加专业的图形学人会告诉你：<strong>像素是一组离散的对场景颜色的采样结果</strong>，之所以这么说，是因为像素可能是一个采样点，也可能是多个采样点混合而成的，它的采样区域可能是方形的，也可能是圆形的。</p><p>所以，网格像素模型只是一种光栅化的时候简化像素的处理：我们认为在这个网格区域内，只产生一次采样，它处于网格的正中心。</p><p>那么如果要渲染一个场景，只需要把每一个网格填上颜色就可以了，光栅化实际上就是在聊怎么填颜色这件事情。比如你需要对场景里的物体进行排序，离相机近的物体表面颜色就是你想要绘制的图形的颜色。</p><blockquote><p>光线追踪技术则是基于物理，从一个像素点出发，经过多次反射，得到最终颜色，但是一个像素一条射线远远不够，因为这样误差会很大，往往一个像素需要数百条射线的结果求平均。</p><p><strong>光线追踪的本质就是对场景不断进行采样以降低噪点，最终得到最接近真实的图像。</strong></p></blockquote><p>从时间复杂度来说，光栅化无疑比光线追踪来得更加好，但是因为缺少严谨的物理模型，光栅化的效果比光线追踪差很多，所以在对性能要求不高，但是对效果要求高的离线渲染中，光线追踪被普遍运用。</p><blockquote><p>截至文章编写日期，已经有游戏比如 <code>赛博朋克2077 2.0</code> 运用了 <code>Path Tracing</code> 技术，也叫 <code>Monte Calo Ray Tracing</code>，比传统的 <code>Whitted Style Ray Tracing</code> 性能更加好，效果也更棒。</p></blockquote><h2 id=光栅化程序开发流程>光栅化程序开发流程</h2><ol><li>创建一个窗口，并绘制直线，三角形，带有顶点数据的物体。</li></ol><p>施工中&mldr;</p><h2 id=reference>Reference</h2><p>Fundamentals of Computer Graphics</p></section><footer class=article-footer><section class=article-tags><a href=/tags/computer-graphics/>Computer Graphics</a>
<a href=/tags/ray-tracing/>Ray Tracing</a>
<a href=/tags/rasterization/>Rasterization</a>
<a href=/tags/softrenderer/>SoftRenderer</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E5%9B%9B%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E5%BD%A2/><div class=article-details><h2 class=article-title>编写光栅化渲染器（四）绘制三角形</h2></div></a></article><article><a href=/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%89%E7%BB%98%E5%88%B6%E7%9B%B4%E7%BA%BF/><div class=article-details><h2 class=article-title>编写光栅化渲染器（三）绘制直线</h2></div></a></article><article><a href=/p/%E7%BC%96%E5%86%99%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93%E5%99%A8%E4%BA%8Csdl%E5%BA%93%E7%AE%80%E4%BB%8B/><div class=article-details><h2 class=article-title>编写光栅化渲染器（二）SDL库简介</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=nonlinearthink/nonlinearthink.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyNTQ3MTc3NDc=" data-category=Announcements data-category-id=DIC_kwDODy6vM84CbsFQ data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en-us data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2019 -
2024 nonlinearthink</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>